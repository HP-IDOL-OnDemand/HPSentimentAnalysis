DESCRIPTION
===========

VerticaConnection provides a library to connect, query and update a Vertica database using Vertica's jdbc driver.
It also includes a command line application to add records into the database reading from standard input or from a file.

The standalone application expects to read from standard input or a file lines with the following format:

    column1|column2|...|columnN

You can add values into the tables tweet or sentiment, depending on what you pass as command line argument.

For the tweet table, a row can either be

    id|message|language|created_at|aggregate_sentiment|aggregate_score

or

    id|message|language|created_at

in case you do not have the aggregate information. `created_at` is expected to be formatted as "yyyy-MM-dd HH:mm:ss" 
and the message column is expected to have the "|" charater escaped and line breaks replaced by their string 
representation "\n"

For the sentiment table, rows must have the format

    tweet_id|sentiment|topic|score

In order to pass NULL values to `sentiment` or `topic`, use the string "null", e.g.

    121231234|love|null|0.99

At the end, you will receive the number of rows inserted.

SOURCE DESCRIPTION
==================

`Vertica` is the class that creates the data source, connects with Vertica and performs the queries.

It uses Spring's SimpleDriverDataSource to establish the connection and Spring's JdbcTemplate to query the database.

RUN
===

Once installed,

    JAVA_OPTS="-Dvertica.hostname=192.168.1.17 -Dvertica.database=topcoder -Dvertica.username=dbadmin -Dvertica.password=password" \
    build/install/VerticaConnection/bin/VerticaConnection -h

On Windows

    set JAVA_OPTS=-Dvertica.hostname=192.168.1.17 -Dvertica.database=topcoder -Dvertica.username=dbadmin -Dvertica.password=password
    build/install/VerticaConnection/bin/VerticaConnection.bat -h
 
ADDITIONAL DIRECTORIES
======================

This project includes three additional directories:

- `libs`    includes the Vertica JDBC driver.
- `scripts` includes a bash script to take the output generated by TwitterCollect and IdolSentimentAnalysis and
            generate tbl files to populate the database. It also includes scripts to create the database and load 
            it with data.This sql scripts must be run directly in the Vertica server. This directory is include
            in the installation distribution when running `gradle installApp`
- `db`      includes sample tbl files to populate the database. This directory is include in the installation
            distribution when running `gradle installApp`

scripts/extract_tbl_files.bash
------------------------------

This script receives the input files generated by TwitterCollect and IdolSentimentAnalysis as arguments and generates
two files:

- tweet.tbl contains the rows to be inserted in the tweet table.
- sentiment.tbl contains the rows to be inserted in the sentiment table.

Example run: `scripts/extract_tbl_files tweet.out sentiment.out`

scripts/*.sql
-------------

These scripts must be run from the Vertica server to create the database and load it with data provided from tbl files
generated by `extract_tbl_files.bash`. Before loading, verify that the filename references for the tbl files in 
`load_data.sql` are correct.

This projected is licensed under the terms of the MIT license.